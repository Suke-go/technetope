# Locomotion Robot Motion Planner

`locomotion/robot` は toio 群の「遊ぶような」移動挙動を合成するアルゴリズムを切り出したプレースホルダです。座標系や入出力の実線化は上位レイヤーに委ね、ここではロボットを点として扱い、群れ／障害物／ランダム性（報酬系）を考慮した速度ベクトルを計算します。

## API 概要

`include/locomotion/robot/MotionPlanner.h` で公開される主要構造体は次のとおりです。

- `RobotIntent` – 1 台のロボットについて、現在状態 (`RobotState`)、目標 (`RobotGoal`)、開放度を決める簡易報酬 (`RewardSignal`) をまとめたもの。  
- `DynamicObstacle` – 人の足など動的障害物の予測サンプル列。各サンプルは「何秒後に」「どこへ」「どれくらい確からしいか」を記録します。  
- `MotionPlannerConfig` – 速度・加速度制約、近傍／障害物の影響半径、ランダム性のスケール係数など。後で外部設定ファイルから流し込めるよう既定値付きで定義しています。  
- `MotionPlanner::Plan()` – 各ロボットの線速度（プレイマット平面上の 2D）と角速度を返却します。面外（Z 軸）や Position ID ↔ mm の換算は呼び出し側で行ってください。

## アルゴリズムざっくり説明

1. **目標吸引** – 目標位置へ向かうベクトル、および任意の指示速度を足し合わせて基準速度を作ります。  
2. **群れとの距離保持** – 影響半径内のロボットから距離に応じた斥力を付加します。  
3. **動的障害物回避** – 将来サンプルを時間減衰させながら足し合わせ、危険度の高い方向への移動を抑えます。  
4. **報酬ベースゆらぎ** – `RewardSignal` の安全度・好奇心・緊急度を元にランダム速度成分の標準偏差を調整します。  
5. **制約適用** – 加速度リミットと一次遅れによるスムージングを掛け、最終的な最大速度内に正規化します。

内部状態として、各ロボットの直前コマンドを保持し、次回の加速度制限やスムージングで利用します。`Reset()` でプロファイルをクリアできるので、シーン切り替え時に呼び出してください。

## ビルド

単体ビルド時は以下でスタティックライブラリ `locomotion_robot` が生成されます。上位アプリからは `add_subdirectory(locomotion/robot)` してリンクしてください。

```bash
cmake -S locomotion/robot -B build/robot
cmake --build build/robot
```

依存ライブラリは C++20 標準ライブラリのみです（追加アルゴリズムを導入する際は CMakeLists.txt に追記してください）。
